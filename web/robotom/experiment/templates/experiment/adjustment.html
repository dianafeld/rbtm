{% extends "base.html" %}
{% block content %}

   <script type="text/javascript">
        function Disable() {
            document.getElementById('picture_exposure_submit').value="Получение...";
            document.getElementById('picture_exposure_submit').disabled = true;
            document.getElementById('picture_exposure_submit').readonly = true;
            document.forms['picture_exposure_form'].submit();
            return false;
        }

        function post(path, params) {
		    var form = document.createElement("form");
		    form.setAttribute("method", "post");
		    form.setAttribute("action", path);

		    for(var key in params) {
		        if(params.hasOwnProperty(key)) {
		            var hiddenField = document.createElement("input");
		            hiddenField.setAttribute("type", "hidden");
		            hiddenField.setAttribute("name", key);
		            hiddenField.setAttribute("value", params[key]);

		            form.appendChild(hiddenField);
		         }
		    }

		    var hiddenField = document.createElement("input");
		    hiddenField.setAttribute("type", "hidden");
		    hiddenField.setAttribute("name", "csrfmiddlewaretoken");
	        hiddenField.setAttribute("value", "{{ csrf_token }}");
            form.appendChild(hiddenField);

		    document.body.appendChild(form);
		    form.submit();
		}
    </script> 

    {% if messages %}
        <div class="row">
            {% for message in messages %}
                <div class="col-sm-6 col-sm-offset-3 col-lg-4 col-lg-offset-3">
                    <div class="alert alert-{% if message.tags %}{% if message.tags == "error" %}danger{% else %}{{ message.tags }}{% endif %}{% else %}info{% endif %}">
                        {{ message }}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-md-6 col-lg-6">
                <div class="panel panel-default">

                    <div class="panel-heading">
                        <h3>Юстировка томографа</h3>
                    </div>

                    <div class="panel-body">
                        <div class="row">
                            <div class="col-xs-6">
                                <form method="POST" action="">
                                    <div class="control-group">
                                        {% csrf_token %}
                                        <label for="voltage">Напряжение</label> <button type="button" onclick="post('', {'refresh': 'voltage'})" class="btn btn-success btn-xs"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
                                       	<div class="current_value"><small>Текущее напряжение: 
                                       	{% if tomograph.voltage == None %}
                                       	неизвестно
                                       	{% else %}
                                       	{{ tomograph.voltage }} кВ
                                       	{% endif %}   	
                                       	</small></div>

                                        <div class="input-group">
                                            <input type="number" step="0.01" min="2" max="60"
                                                   class="form-control ntSaveForms" required
                                                   id="voltage" name="voltage" placeholder="2-60"
                                                   value="{{ tomograph.voltage }}">

                                            <div class="input-group-addon">кВ</div>
                                        </div>
                                        {% if user.is_authenticated and user.userprofile.is_experimentator and off == 0 and exper == 0 %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="experiment_on_voltage"
                                                   value="Отправить">
                                        {% else %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="experiment_on_voltage_adm"
                                                   value="Отправить" disabled>
                                        {% endif %}
                                    </div>
                                </form>
                            </div>
                            <div class="col-xs-6">
                                <form method="POST" action="">
                                    {% csrf_token %}
                                    <label for="current">Ток</label> <button type="button" onclick="post('', {'refresh': 'current'})" class="btn btn-success btn-xs"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
                                       	<div class="current_value"><small>Текущая сила тока: 
                                       	{% if tomograph.current == None %}
                                       	неизвестна
                                       	{% else %}
                                       	{{ tomograph.current }} мА
                                       	{% endif %}   	
                                       	</small></div>

                                    <div class="input-group">
                                        <input type="number" step="0.01" min="2" max="80"
                                               class="form-control ntSaveForms" required id="current" name="current" placeholder="2-80" value="{{ tomograph.current }}">

                                        <div class="input-group-addon">мА</div>
                                    </div>
                                    {% if user.is_authenticated and user.userprofile.is_experimentator and off == 0 and exper == 0 %}
                                        <input type="submit"
                                               style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                               class="btn btn-default btn-md" name="experiment_on_current"
                                               value="Отправить">
                                    {% else %}
                                        <input type="submit"
                                               style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                               class="btn btn-default btn-md" name="experiment_on_current_adm"
                                               value="Отправить" disabled>
                                    {% endif %}
                                </form>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xs-6">
                                <form method="POST" action="">
                                    <div class="control-group">
                                        {% csrf_token %}
                                        <label for="move_hor">Сдвиг по горизонтали</label> <button type="button" onclick="post('', {'refresh': 'horizontal_shift'})" class="btn btn-success btn-xs"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
                                       	<div class="current_value"><small>Текущий сдвиг по горизонтали: 
                                       	{% if tomograph.horizontal_shift == None %}
                                       	неизвестно
                                       	{% else %}
                                       	{{ tomograph.horizontal_shift }}
                                       	{% endif %}   	
                                       	</small></div>

                                        <input type="number" step="1" min="0" class="form-control ntSaveForms"
                                               required id="move_hor" name="move_hor" placeholder="" value="{{ tomograph.horizontal_shift }}">
                                        {% if user.is_authenticated and user.userprofile.is_experimentator and off == 0 and exper == 0 %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="move_hor_submit"
                                                   value="Сдвинуть образец">
                                        {% else %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="move_hor_adm"
                                                   value="Сдвинуть образец" disabled>
                                        {% endif %}
                                    </div>
                                </form>
                            </div>
                            <div class="col-xs-6">
                                <form method="POST" action="">
                                    <div class="control-group">
                                        {% csrf_token %}
                                        <label for="move_ver">Сдвиг по вертикали</label> <button type="button" disabled onclick="post('', {'refresh': 'vertical_shift'})" class="btn btn-success btn-xs"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
                                       	<div class="current_value"><small>Текущий сдвиг по вертикали: 
                                       	{% if tomograph.vertical_shift == None %}
                                       	неизвестно
                                       	{% else %}
                                       	{{ tomograph.vertical_shift }}
                                       	{% endif %}   	
                                       	</small></div>

                                        <input type="number" step="1" min="0" class="form-control ntSaveForms"
                                               required disabled
                                               id="move_ver" name="move_ver" placeholder="" value="{{ tomograph.vertical_shift }}">
                                        {% if user.is_authenticated and user.userprofile.is_experimentator and off == 0 and exper == 0 %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" disabled name="move_ver_submit"
                                                   value="Сдвинуть образец">
                                        {% else %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="move_ver_adm"
                                                   value="Сдвинуть образец" disabled>
                                        {% endif %}
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6">
                                <form method="POST" action="">
                                    <div class="control-group">
                                        {% csrf_token %}
                                        <label for="rotate">Изменить угловое положение</label> <button type="button" onclick="post('', {'refresh': 'angle'})" class="btn btn-success btn-xs"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
                                       	<div class="current_value"><small>Текущий угол: 
                                       	{% if tomograph.angle == None %}
                                       	неизвестно
                                       	{% else %}
                                       	{{ tomograph.angle }}&deg;
                                       	{% endif %}   	
                                       	</small></div>

                                        <div class="input-group">
                                            <input type="number" step="0.01" min="0" class="form-control ntSaveForms"
                                                   required id="rotate" name="rotate" placeholder="" value="{{ tomograph.angle }}">

                                            <div class="input-group-addon">&deg;</div>
                                        </div>
                                        {% if user.is_authenticated and user.userprofile.is_experimentator and off == 0 and exper == 0 %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="rotate_submit"
                                                   value="Повернуть">
                                        {% else %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="rotate_adm"
                                                   value="Повернуть" disabled>
                                        {% endif %}
                                    </div>
                                </form>
                            </div>
                            <div class="col-xs-6">
                                <form method="POST" action="">
                                    <div class="control-group">
                                        {% csrf_token %}
                                        <label for="text_gate">Заслонка</label> <button type="button" disabled onclick="post('', {'refresh': 'shutter'})" class="btn btn-success btn-xs"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
                                       	<div class="current_value"><small>Текущее состояние заслонки: 
                                       	{% if tomograph.shutter == None %}
                                       	неизвестно
                                       	{% else %}
                                       		{% if tomograph.shutter == 'open' %}
                                       		открыта
                                       		{% else %}
                                       		закрыта
                                       		{% endif %}
                                       	{% endif %}   	
                                       	</small></div>

                                        <div id="text_gate" class="btn-group" data-toggle="buttons">
                                            <label class="btn btn-default {% if tomograph.shutter == 'open' %} active {% endif %}" id="open"> <input id="open" name="gate_state" type="radio" value="open" {% if tomograph.shutter == 'open' %} checked {% endif %}>Открыта</label>
                                            <label class="btn btn-default {% if tomograph.shutter == 'closed' %} active {% endif %}>" id="close"> <input id="close" name="gate_state" type="radio" value="close" {% if tomograph.shutter == 'closed' %} checked {% endif %}>Закрыта</label>
                                        </div>

                                        {% if user.is_authenticated and user.userprofile.is_experimentator and off == 0 and exper == 0 %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="text_gate"
                                                   value="Установить заслонку">
                                        {% else %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="text_gate_adm"
                                                   value="Установить заслонку" disabled>
                                        {% endif %}

                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6">
                                <form method="POST" action="">
                                    <div class="control-group">
                                        {% csrf_token %}
                                        {% if user.is_authenticated and user.userprofile.is_experimentator and off == 0 and exper == 0 %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="reset_submit"
                                                   value="Принять текущий угол поворота за 0">
                                        {% else %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="reset_adm"
                                                   value="Принять текущий угол поворота за 0" disabled>
                                        {% endif %}
                                    </div>
                                </form>

                            </div>
                            <div class="col-xs-6">
                                <form name="picture_exposure_form" method="POST" action="">
                                    <div class="control-group">
                                        {% csrf_token %}
                                        <label for="picture_exposure">Экспозиция</label>

                                        <div class="input-group">
                                            <input type="number" min="0" step="0.01" name="picture_exposure" id=
                                                    "picture_exposure" class="form-control ntSaveForms" required>

                                            <div class="input-group-addon">мс</div>
                                        </div>

                                        {% if user.is_authenticated and user.userprofile.is_experimentator and off == 0 and exper == 0 %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="picture_exposure_submit"
                                                   id="picture_exposure_submit"
                                                   value="Предпросмотр">
                                        {% else %}
                                            <input type="submit"
                                                   style="white-space:normal; margin-top:7px; margin-bottom:7px"
                                                   class="btn btn-default btn-md" name="picture_exposure_adm"
                                                   value="Предпросмотр" disabled>
                                        {% endif %}
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-md-6 col-lg-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3>Предпросмотр  {% if preview %}
                            <small>Экспозиция: {{ exposure }} мс</small>{% endif %}</h3>
                    </div>
                    <div class="panel-body">
                        {% if preview %}
                            <img class="img-responsive center-block" src="{{ preview_path }}">
                        {% else %}
                            {% load staticfiles %}
                            <img class="img-responsive center-block" height="75%" width="75%"
                                 src="{% static 'experiment/images/noimage.png' %}">
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!--<button type="submit" style="white-space:normal; margin-top:7px; margin-bottom:7px" class="btn btn-default ntSaveFormsSubmit">Очистить поля</button>-->
    </div>

    {% load staticfiles %}
    <!--<script type='text/javascript' src="{% static 'experiment/js/ntsaveforms.js' %}"></script>-->
{% endblock content %}
